name: Cross Platform Release

on:
    push:
        tags:
            - '*'

env:
    NODE_OPTIONS: "--max-old-space-size=4096"

jobs:
    build:
        strategy:
            fail-fast: false
            matrix:
                build:
                    - name: "tsdoa"
                      platform: "linux/amd64"
                      os: "ubuntu-latest"
                    - name: "tsdoa"
                      platform: "windows/amd64"
                      os: "windows-latest"
                    - name: "tsdoa"
                      platform: "darwin/universal"
                      os: "macos-latest"
        
        runs-on: ${{ matrix.build.os }}

        steps:
            - name: Checkout
              uses: actions/checkout@v4
              with:
                submodules: 'recursive'

            - name: Setup pnpm
              uses: pnpm/action-setup@v4
              with:
                version: 10
            
            - name: Build Wails App
              uses: dAppServer/wails-build-action@main
              id: build
              with:
                build-name: ${{ matrix.build.name }}
                build-platform: ${{ matrix.build.platform }}
                package: true
                nsis: true
                go-version: "1.24"